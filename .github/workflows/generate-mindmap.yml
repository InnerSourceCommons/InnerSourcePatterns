name: Generate Mindmap

on:
  push:
    branches:
      - "main"
  pull_request:
    # paths:
    #   - ".github/workflows/generate-mindmap.yml"
    #   - "pattern-categorization/innersource-program-mind-map.md"

jobs:
  generate-mindmap:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2
    - name: Use Node.js
      uses: actions/setup-node@v2
      with:
        node-version: 12.x
        cache: 'npm'
        cache-dependency-path: pattern-categorization/package-lock.json
    - name: Install Node.js dependencies
      run: |
        cd pattern-categorization/
        npm install
    - name: Run Markmap
      run: |
        cd pattern-categorization/
        npx markmap --no-toolbar innersource-program-mind-map.md -o innersource-program-mind-map.html
    - name: Screenshot Markmap Website
      id: screenshot-generator
      uses: swinton/screenshot-website@v1.x
      with:
        source: pattern-categorization/innersource-program-mind-map.html
        destination: innersource-program-mind-map.png
        full-page: false
    - name: Compress PNG
      run: |
        cd pattern-categorization
        npx optipng ${{ steps.screenshot-generator.outputs.path }}
    - name: Copy Screenshot
      run: cp ${{ steps.screenshot-generator.outputs.path }} pattern-categorization/
    - name: Commit Changes
      uses: stefanzweifel/git-auto-commit-action@v4
      with:
        commit_message: Re-creating markmap and screenshot
