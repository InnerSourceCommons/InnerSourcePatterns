## Title

Common Requirements

## Patlet

共有リポジトリにある共通のコードは、それを使いたいすべてのプロジェクトチームのニーズを満たしていません。これは、要件の調整とリファクタリングによって解決されます。

## 問題

共有リポジトリにある共通コードは、それを使いたいすべてのプロジェクトのニーズを満たしていない。 

## 状況

* 多くのプロジェクトが共通のコードを使おうとしている。 すべてのプロジェクトがアクセスする共有リポジトリがある。
* 誰かが（またはどこかのプロジェクトが）最初にコードを書き、リポジトリに寄稿した。
* 共通コードは、どのプロジェクトからの成果物全体から見ても、わずかな割合である。
* 各プロジェクトには、それぞれ独自の納期、成果物、顧客がある。
* このパターンは、これらの状況のいずれにも当てはまります。
    * **強力なコード所有者** すなわち、共有リポジトリへのすべての変更は、リポジトリの所有者によって承認されなければならない。
    * **弱いコードオーナー** すなわち、誰も本当にコードを所有していない。
    * **ベネヴォレント・スポンサー** が **いない**。 つまり、InnerSource方式で共通コードを整理するためのリソースを提供する組織や幹部がいない。



## ブロッカーと成りうるちから (Forces)

コードを利用可能にしたプロジェクトには、1つのニーズがあります。そのニーズは、受け手の組織の一部が望んでいるものと似ていますが、まったく同じではありません。
コードに関する要件は、実際の顧客のニーズから導き出される必要があります。 

異なる顧客のニーズは一般的に非常によく似ていますが、顧客によって表現が異なったり、重みが異なったりする場合があります。例えば、ある顧客はある方法で結果を表示してほしいが、他の顧客は逆の順序で表示してほしいというようなことです。両者の翻訳を行うのは簡単だが、一方のケースで追加のコーディングが必要となり、その結果、結果を計算するモジュールを両方の顧客で再利用することができない。

多くの顧客は、サプライヤーが必要なものを知るための手助けを望んでいる。この会社では、多くの「システムエンジニア」が製品の要求事項を書いている。 これらの要件は、製品の開発を導くために顧客のニーズを抽出したものであるはずだ。
コードの再利用は、会社の時間とお金を節約するための重要な目標である。 

## ソリューション

この問題を解決するには、2つの側面があり、並行して行う必要があります。

1. あるプロジェクトの要件を満たすコードが、他のプロジェクトのニーズも満たすように、各プロジェクトの要件を揃える。
2. コードをリファクタリングして、多くの使用プロジェクトが要件に合意できるような小さな断片にする。

さらに、顧客がサプライヤに要求事項の解明を期待していることを利用する。顧客との交渉の中で要件のすり合わせを行い、コンポーネントを変更するのではなく、顧客の要件に影響を与える。

上記の例では、サプライヤーは、両方の顧客が同じものを求めていることを理解し、同じフォーマットで結果を受け入れることに同意すれば、全員の労力（および費用）を節約することができる。

![Common Requirements](../../assets/img/CommonReqtsv2.jpg)

## 結果の状況

そのためには、顧客と要件の変更について交渉する必要があるかもしれない。 また、営業チームやプロダクトマネージャーを巻き込んで、要件のすり合わせを行う必要があるかもしれない。 顧客は、変更に同意するために、割引などのインセンティブを必要とするかもしれない。

関連する課題（および新しいパターンの可能性）として、InnerSourceを採用しているある企業で報告された循環型ストーリーライティングの演習がある。簡単に言えば

* 開発者は、ある方法で問題を解決するためにストーリーを書く。 
* プログラムマネージャーは、より良い彼らのニーズを表現するためにストーリーを書き換える - エッセンスは同じままである。しかし、開発者のもとに戻ってきたときには、それが自分たちのやりたかったことだと認識されておらず、そのため、実装に躊躇してしまう。 
* このパターンの解決策は、開発者やプログラムマネージャーの陣営だけでなく、プロジェクト全体でストーリーの修正が理解されるように、プランニングテーブルの周りに多くの席を設けることである。

## 事例

* Large telecom provider

## ステータス

* Structured

## 著者

Robert Hanmer

## 謝辞

* Manrique Lopez
* Daniel Izquierdo
* Tim Yao
* Sebastian Spier
